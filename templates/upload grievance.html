{% extends "base.html" %}
{% block title %}Share your grievance{% endblock %}
{% block add_head %}
    <link href="https://vjs.zencdn.net/8.6.0/video-js.css" rel="stylesheet"/>
    <link rel="stylesheet" href="//unpkg.com/videojs-record/dist/css/videojs.record.min.css">
{% endblock %}
{% block body %}
    {% load widget_tweaks %}
<div class="mar">

    <div style="margin-top: 50px;margin-bottom: 50px;">
        <h1 class="_heading" style="font-size: 68px; margin-top: 40px; margin-bottom: 50px;"><b>Shikayat Forum</b></h1>
        <h4>Directly record your shikayat and get it registered on the Shikayat forum</h4>
        <audio style="margin-right: 53px;margin-top: 59px;" id="audioPlayer" controls>
        </audio>
        <br>
        <button type="button" class="btn btn-primary" id="rec">Start Recording<a style="font-size: 25px;">🎙️</a></button>
        <button type="button" class="btn btn-success" id="sub"><a style="font-size: 25px;">Submit</a></button>
    </div>

    <script src="{% static 'audioRecorder.js' %}"></script>
    <script>
<<<<<<< HEAD
        const recButton = document.getElementById("rec");
        const subButton = document.getElementById("sub");
        let output = document.getElementById('audioPlayer');
        output.hidden = true;
        let audioRecorder;
        let formData = new FormData();
        let started = false;
        let submit = document.getElementById('sub')

        navigator.mediaDevices.getUserMedia({audio: true})
            .then(stream => {

                // Initialize the media recorder object
                audioRecorder = new MediaRecorder(stream);

                // dataavailable event is fired when the recording is stopped
                audioRecorder.addEventListener('dataavailable', e => {
                    formData.set("audio", e.data, "audio.webm");
                    output.src = URL.createObjectURL(e.data);
                });

                // start recording when the start button is clicked
                recButton.addEventListener('click', () => {
                    if (started) {
                        audioRecorder.stop();
                        recButton.innerHTML = 'Start Recording <a style="font-size: 25px;">🎙️</a>';
                        output.hidden = false;

                    } else {
                        audioRecorder.start();
                        recButton.innerHTML = 'Stop Recording <a style="font-size: 25px;">🎙️</a>';
                        output.hidden = true;
                    }
                    started = !started;
                });

                // play the recorded audio when the play button is clicked
                subButton.addEventListener('click', () => {
                    $.ajax({
                        method: 'POST',
                        processData: false,
                        mimeType: 'multipart/form-data',
                        contentType: false,
                        data: formData,
                        async: false,
                        success: (data, textStatus) => {
                            window.location = (JSON.parse(data)).url;
                        }
                    });
                });
            });
=======
        recordAudio();
>>>>>>> 715bf83736af23eff8ad79482b1c4d4a328ca740
    </script>
    </div>
{% endblock %}